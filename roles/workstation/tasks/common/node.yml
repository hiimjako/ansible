---
# - name: Install nodejs and npm
#   package: 
#     name: 
#       - nodejs
#       - npm
#     state: present
#   become: yes
#   become_user: root
#   tags: &tags_for_node_tasks ["install", "node", "nvm", "npm"]

- name: Install nvm 
  shell: >
    curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash
  args:
    creates: "{{ ansible_env.HOME }}/.nvm/nvm.sh"
    warn: false
  register: nvm_installed
  tags: &tags_for_node_tasks ["install", "node", "nvm", "npm"]
  # tags: *tags_for_node_tasks

# - name : source bash profiles
#   shell : source /home/{{ username }}/.bashrc
#   when: nvm_installed
#   register: source

- name: Install correct version of Node
  shell: >
     bash -c "source ~/.nvm/nvm.sh && nvm install 14 && nvm alias default node"
  args:
    creates: "/home/{{ ansible_env.HOME }}/.nvm/alias"
  tags: *tags_for_node_tasks
    
- name: Install Typescript
  shell: >
     bash -c "source ~/.nvm/nvm.sh && npm i -g typescript" 
  tags: *tags_for_node_tasks

- name: Install Typescript server
  shell: >
    bash -c "source ~/.nvm/nvm.sh && npm i -g typescript-language-server"
  tags: *tags_for_node_tasks

- name: Install TS-Node
  shell: >
     bash -c "source ~/.nvm/nvm.sh && npm i -g ts-node" 
  tags: *tags_for_node_tasks

- name: Install eslint server
  shell: >
     bash -c "source ~/.nvm/nvm.sh && npm i -g vscode-langservers-extracted" 
  tags: *tags_for_node_tasks
