---
# - name: Install nodejs and npm
#   package:
#     name:
#       - nodejs
#       - npm
#     state: present
#   become: yes
#   become_user: root
#   tags: &tags_for_node_tasks ["install", "node"]

- name: Install nvm
  shell: >
    curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash
  args:
    creates: "{{ ansible_env.HOME }}/.nvm/nvm.sh"
    warn: false
  register: nvm_installed
  tags: &tags_for_node_tasks ["init", "nodejs"]
  # tags: *tags_for_node_tasks

# - name : source bash profiles
#   shell : source /home/{{ username }}/.bashrc
#   when: nvm_installed
#   register: source

- name: Install correct version of Node
  shell: >
    bash -c "source ~/.nvm/nvm.sh && nvm install {{ nodejs.version }} && nvm alias default node"
  args:
    creates: "/home/{{ ansible_env.HOME }}/.nvm/alias"
  tags: *tags_for_node_tasks
